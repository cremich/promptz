<!doctype html>
<html lang="{{ .Site.LanguageCode | default "en" }}" class="dark">
  <head>
    {{ partial "head.html" . }}
  </head>
  <body class="bg-background text-foreground min-h-screen flex flex-col">
    {{ partial "header.html" . }}


    <main class="flex-1">{{ block "main" . }}{{ end }}</main>

    {{ partial "footer.html" . }}
    <!-- Search Modal Dialog -->
    <dialog
      id="search-modal"
      class="dialog w-full sm:max-w-2xl max-h-[80vh]"
      aria-labelledby="search-modal-title"
      onclick="if (event.target === this) this.close()"
    >
      <article class="flex flex-col max-h-full">
        <header class="flex-shrink-0">
          <h2 id="search-modal-title">Find Prompts, Rules & Agents</h2>
          <p>Search through our comprehensive library for Amazon Q Developer</p>
        </header>

        <section class="flex-1 overflow-y-auto">
          <div id="modal-search"></div>
        </section>

        <button
          type="button"
          aria-label="Close dialog"
          onclick="this.closest('dialog').close()"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M18 6 6 18" />
            <path d="m6 6 12 12" />
          </svg>
        </button>
      </article>
    </dialog>

    {{ with resources.Get "js/basecoat.js" | minify | fingerprint }}
      <script src="{{ .RelPermalink }}" defer></script>
    {{ end }}
    <script src="/pagefind/pagefind-ui.js"></script>

    <script>
      let searchUI;

      // Initialize modal search UI
      function initModalSearch() {
        if (!searchUI) {
          searchUI = new PagefindUI({
            element: "#modal-search",
            showSubResults: false,
            showImages: false,
            excerptLength: 30,
            resetStyles: false,
          });
        }
      }

      // Command+K shortcut to open search modal
      document.addEventListener("keydown", function (e) {
        if ((e.metaKey || e.ctrlKey) && e.key === "k") {
          e.preventDefault();
          const modal = document.getElementById("search-modal");
          modal.showModal();
          document.body.style.overflow = "hidden"; // Disable body scroll
          initModalSearch();
          // Focus search input after modal opens
          setTimeout(() => {
            const searchInput = document.querySelector(
              "#modal-search .pagefind-ui__search-input",
            );
            if (searchInput) searchInput.focus();
          }, 100);
        }
      });

      // Restore body scroll when modal closes
      document
        .getElementById("search-modal")
        .addEventListener("close", function () {
          document.body.style.overflow = "";
        });
    </script>
  </body>
</html>

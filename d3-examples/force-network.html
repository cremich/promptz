<!doctype html>
<html>
  <head>
    <title>Agent Config - Force Network</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .node {
        cursor: pointer;
      }
      .node.agent {
        fill: #ff6b6b;
      }
      .node.tool {
        fill: #4ecdc4;
      }
      .node.resource {
        fill: #45b7d1;
      }
      .node.prompt {
        fill: #96ceb4;
      }
      .node.mcp {
        fill: #feca57;
      }
      .link {
        stroke: #999;
        stroke-opacity: 0.6;
        stroke-width: 2px;
      }
      .tooltip {
        position: absolute;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px;
        border-radius: 4px;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <h1>Backlog Agent - Force Network Visualization</h1>
    <svg width="800" height="600"></svg>

    <script>
      const agentConfig = {
        name: "backlog-agent",
        description:
          "Keeps your Github backlog up-to-date with feature requests and bug fixes.",
        tools: ["fs_read", "execute_bash", "@context7"],
        allowedTools: ["fs_read", "@context7"],
        resources: ["file://.github/ISSUE_TEMPLATES/*.md", "file://README.md"],
        prompt:
          "Your task is to maintain the backlog of this repository on Github...",
      };

      const nodes = [
        {
          id: "agent",
          type: "agent",
          name: agentConfig.name,
          description: agentConfig.description,
        },
        {
          id: "prompt",
          type: "prompt",
          name: "System Prompt",
          description: agentConfig.prompt.substring(0, 100) + "...",
        },
        ...agentConfig.tools.map((tool) => ({
          id: tool,
          type: "tool",
          name: tool,
          description: `Tool: ${tool}`,
        })),
        ...agentConfig.resources.map((res, i) => ({
          id: `res-${i}`,
          type: "resource",
          name: res.split("/").pop(),
          description: res,
        })),
        {
          id: "mcp",
          type: "mcp",
          name: "MCP Servers",
          description: "Model Context Protocol servers",
        },
      ];

      const links = [
        { source: "agent", target: "prompt" },
        { source: "agent", target: "mcp" },
        ...agentConfig.tools.map((tool) => ({ source: "agent", target: tool })),
        ...agentConfig.resources.map((res, i) => ({
          source: "agent",
          target: `res-${i}`,
        })),
      ];

      const svg = d3.select("svg");
      const width = +svg.attr("width");
      const height = +svg.attr("height");

      const simulation = d3
        .forceSimulation(nodes)
        .force(
          "link",
          d3
            .forceLink(links)
            .id((d) => d.id)
            .distance(100),
        )
        .force("charge", d3.forceManyBody().strength(-300))
        .force("center", d3.forceCenter(width / 2, height / 2))
        .force("collide", d3.forceCollide().radius(30));

      const link = svg
        .append("g")
        .selectAll("line")
        .data(links)
        .join("line")
        .attr("class", "link");

      const node = svg
        .append("g")
        .selectAll("circle")
        .data(nodes)
        .join("circle")
        .attr("class", (d) => `node ${d.type}`)
        .attr("r", (d) => (d.type === "agent" ? 25 : 15))
        .call(
          d3
            .drag()
            .on("start", dragstarted)
            .on("drag", dragged)
            .on("end", dragended),
        );

      const labels = svg
        .append("g")
        .selectAll("text")
        .data(nodes)
        .join("text")
        .text((d) => d.name)
        .attr("font-size", "12px")
        .attr("text-anchor", "middle")
        .attr("dy", 4);

      // Tooltip
      const tooltip = d3
        .select("body")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

      node
        .on("mouseover", function (event, d) {
          tooltip.transition().duration(200).style("opacity", 0.9);
          tooltip
            .html(`<strong>${d.name}</strong><br/>${d.description}`)
            .style("left", event.pageX + 10 + "px")
            .style("top", event.pageY - 28 + "px");
        })
        .on("mouseout", function (d) {
          tooltip.transition().duration(500).style("opacity", 0);
        });

      simulation.on("tick", () => {
        link
          .attr("x1", (d) => d.source.x)
          .attr("y1", (d) => d.source.y)
          .attr("x2", (d) => d.target.x)
          .attr("y2", (d) => d.target.y);
        node.attr("cx", (d) => d.x).attr("cy", (d) => d.y);
        labels.attr("x", (d) => d.x).attr("y", (d) => d.y);
      });

      function dragstarted(event) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        event.subject.fx = event.subject.x;
        event.subject.fy = event.subject.y;
      }

      function dragged(event) {
        event.subject.fx = event.x;
        event.subject.fy = event.y;
      }

      function dragended(event) {
        if (!event.active) simulation.alphaTarget(0);
        event.subject.fx = null;
        event.subject.fy = null;
      }
    </script>
  </body>
</html>

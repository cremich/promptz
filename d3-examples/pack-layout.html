<!doctype html>
<html>
  <head>
    <title>Agent Config - Pack Layout</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .node {
        cursor: pointer;
      }
      .node.agent {
        fill: rgba(255, 107, 107, 0.3);
        stroke: #ff6b6b;
      }
      .node.category {
        fill: rgba(116, 185, 255, 0.2);
        stroke: #74b9ff;
      }
      .node.tool {
        fill: #4ecdc4;
        stroke: #00b894;
      }
      .node.resource {
        fill: #45b7d1;
        stroke: #0984e3;
      }
      .node.prompt {
        fill: #96ceb4;
        stroke: #00b894;
      }
      .node.mcp {
        fill: #feca57;
        stroke: #fdcb6e;
      }
      .label {
        font: 12px sans-serif;
        text-anchor: middle;
        pointer-events: none;
      }
      .tooltip {
        position: absolute;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px;
        border-radius: 4px;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <h1>Backlog Agent - Pack Layout Visualization</h1>
    <svg width="800" height="600"></svg>

    <script>
      const agentConfig = {
        name: "backlog-agent",
        description:
          "Keeps your Github backlog up-to-date with feature requests and bug fixes.",
        tools: ["fs_read", "execute_bash", "@context7"],
        allowedTools: ["fs_read", "@context7"],
        resources: ["file://.github/ISSUE_TEMPLATES/*.md", "file://README.md"],
        prompt:
          "Your task is to maintain the backlog of this repository on Github...",
      };

      const packData = {
        name: agentConfig.name,
        type: "agent",
        description: agentConfig.description,
        children: [
          {
            name: "Tools",
            type: "category",
            children: agentConfig.tools.map((tool) => ({
              name: tool,
              type: "tool",
              description: `Tool: ${tool}`,
              value: 10,
            })),
          },
          {
            name: "Resources",
            type: "category",
            children: agentConfig.resources.map((res) => ({
              name: res.split("/").pop(),
              type: "resource",
              description: res,
              value: 8,
            })),
          },
          {
            name: "System Prompt",
            type: "prompt",
            description: agentConfig.prompt.substring(0, 100) + "...",
            value: 15,
          },
          {
            name: "MCP Servers",
            type: "mcp",
            description: "Model Context Protocol configuration",
            value: 12,
          },
        ],
      };

      const svg = d3.select("svg");
      const width = +svg.attr("width");
      const height = +svg.attr("height");

      const pack = d3.pack().size([width, height]).padding(3);

      const root = d3
        .hierarchy(packData)
        .sum((d) => d.value || 1)
        .sort((a, b) => b.value - a.value);

      pack(root);

      const node = svg
        .selectAll(".node")
        .data(root.descendants())
        .join("circle")
        .attr("class", (d) => `node ${d.data.type || "default"}`)
        .attr("cx", (d) => d.x)
        .attr("cy", (d) => d.y)
        .attr("r", (d) => d.r)
        .attr("stroke-width", (d) =>
          d.depth === 0 ? 4 : d.depth === 1 ? 2 : 1,
        )
        .style("fill-opacity", (d) =>
          d.depth === 0 ? 0.1 : d.depth === 1 ? 0.3 : 0.8,
        );

      const labels = svg
        .selectAll(".label")
        .data(root.descendants().filter((d) => d.r > 20))
        .join("text")
        .attr("class", "label")
        .attr("x", (d) => d.x)
        .attr("y", (d) => d.y)
        .attr("dy", "0.35em")
        .text((d) => d.data.name)
        .style("font-size", (d) => Math.min(d.r / 3, 14) + "px")
        .style("font-weight", (d) => (d.depth === 0 ? "bold" : "normal"));

      // Tooltip
      const tooltip = d3
        .select("body")
        .append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

      node
        .on("mouseover", function (event, d) {
          if (d.data.description) {
            tooltip.transition().duration(200).style("opacity", 0.9);
            tooltip
              .html(`<strong>${d.data.name}</strong><br/>${d.data.description}`)
              .style("left", event.pageX + 10 + "px")
              .style("top", event.pageY - 28 + "px");
          }
        })
        .on("mouseout", function (d) {
          tooltip.transition().duration(500).style("opacity", 0);
        });

      // Add zoom behavior
      const zoom = d3
        .zoom()
        .scaleExtent([0.5, 3])
        .on("zoom", function (event) {
          svg.selectAll("circle, text").attr("transform", event.transform);
        });

      svg.call(zoom);
    </script>
  </body>
</html>
